\documentclass[a4paper, article, oneside]{memoir}

\usepackage{indentfirst}

\usepackage{tikz}
\usetikzlibrary{%
  arrows,%
  arrows.meta,%
  calc,%
  shapes,%
  graphs,%
  positioning,%
}
\newcommand{\tikzinput}[1]{\input{tikz/#1.tikz}}
\tikzinput{syntaxdiagram}

\newcommand{\repruleinput}[1]{%
  \begin{minipage}{2in}%
    \centering%
    \vspace{2ex}%
    \tikzinput{reprule/#1}%
    \vspace{1ex}%
  \end{minipage}%
}

\usepackage{multirow}

\begin{document}
\chapter{Context-free grammer for CUTE Lang}
This chapter explains what context-free grammer is used in CUTE Lang.
To explain efficiently, grammer is explained by syntax diagram.

\section{Syntax diagram representation rules}
Representation rules of syntax diagram are on Table~\ref{tab:Representation_rules_of_syntax_diagram}.

\begin{table}[!htb]
  \centering
  \begin{tabular}{ccc}
    \cline{1-3}
    Repesentation & EBNF Equivalent & Meaning\\
    \cline{1-3}
    \repruleinput{nonterminal} & x & Nonterminal\\ \cline{1-3}
    \repruleinput{terminal} & ``x'' & Terminal\\ \cline{1-3}
    \repruleinput{sequence} & a, b & Sequence\\ \cline{1-3}
    \repruleinput{selection} & a \textbar{} b & Selections\\ \cline{1-3}
    \repruleinput{optional} & [ x ] & Optional\\ \cline{1-3}
    \repruleinput{zerorepeat} & \{ x \} & Zero or more repeat\\ \cline{1-3}
    \repruleinput{onerepeat} & x, \{ x \} & One or more repeat\\ \cline{1-3}
  \end{tabular}
  \caption{Representation rules of syntax diagram}
  \label{tab:Representation_rules_of_syntax_diagram}
\end{table}

\section{Syntax diagram for context-free grammer}
Context-free grammer expressed by syntax diagram is the following.

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    top def[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 -> top f def[nonterminal] --
    p2 -> p3 --[end] end;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    top f def0/top f def[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 -> f def[nonterminal] --
    p2 -> with st[nonterminal] --
    p3 -> p4 --[end] end;

    p2 --[skip way=0.5mm/-7mm] p3;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    f def0/f def[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 -> f head[nonterminal] --
    p2 -> f body[nonterminal] --
    p3 -> p4 --[end] end;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    f head0/f head[definition],
    i0 -!- i1 -!-
    start --[start] p0 -> f id[nonterminal] --
    p1 --[vh way=0.5mm]
    { p2,
      param pat[nonterminal],
    } --[hv way=0.5mm]
    p3 -> p4 --[end] end;

    p1 -- p2 -- p3;
    p3 ->[vh way=0.5mm] param pat --[hv way=0.5mm] p1;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    f body0/f body[definition],
    i0 -!- i1 -!-
    start --[start] p0 -> expr[nonterminal] -- p1 --[end] end;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    with st0/with st[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 -> with[terminal] --
    p2 -> f def[nonterminal] --
    p3 -> p4 --[end] end;

    p2 --[rep way=0.5mm/-7mm] p1;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    expr0/expr[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 -> infix expr[nonterminal] --
    p2 -> "$\dashv$"[terminal] --
    p3 -> type[nonterminal] --
    p4 -> p5 --[end] end;

    p2 --[skip way=0.5mm/-7mm] p4;
  };
\end{tikzpicture}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% If [If expression] is an left expression,
% we cannot deterministically parse following statement.
% ```
%  if true then 1 else 2 + 3
% ```
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    infixexpr0/infix expr[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 ->[vh way=0.5mm]
    { left expr1/left expr[nonterminal] -- biopp0 ->
      biop[nonterminal] -- biopp1 -> infix expr1/infix expr[nonterminal],
      %
      unop[nonterminal] -- unop0 -> left expr2/left expr[nonterminal],
      %
      left expr3/left expr[nonterminal],
      %
      if[terminal] -- ifp0 -> expr1/expr[nonterminal] -- ifp1 ->
      then[terminal] -- ifp2 -> expr2/expr[nonterminal] -- ifp3 ->
      else[terminal] -- ifp4 -> expr3/expr[nonterminal],
      % 
      let[terminal] -- letp0 -> f def[nonterminal] -- letp1 ->
      in[terminal] -- letp2 -> expr4/expr[nonterminal],
      letp3,
      % 
      "$\lambda$"[terminal] -- lamp0 -> param pat[nonterminal] -- lamp1 ->
      "$\rightarrow$"[terminal] -- lamp2 -> expr5/expr[nonterminal],
      lamp3,
    } --[hv way=0.5mm]
    p2 -> p3 --[end] end;

    p1 -> left expr1;
    infix expr1 -- p2;
    p1 -!- letp3 -!- p2;
    p1 -!- lamp3 -!- p2;

    letp1 --[rep way=0.5mm/-7mm] letp0;
    lamp1 --[rep way=0.5mm/-7mm] lamp0;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    left expr0/left expr[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 -> f expr[nonterminal] --
    p2 -> p3 --[end] end;
  };
\end{tikzpicture}

\noindent
\begin{tikzpicture}[syntaxdiagram]
  \graph{
    f expr0/f expr[definition],
    i0 -!- i1 -!-
    start --[start] p0 --
    p1 -> f expr[nonterminal] --
    p2 -> a expr[nonterminal] --
    p3 -> p4 --[end] end;

    p1 --[skip way=0.5mm/-7mm] p2;
  };
\end{tikzpicture}

\end{document}
%
%%% Local Variables:
%%% TeX-engine: xetex
%%% End: